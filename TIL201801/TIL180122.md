# (2018.01.22 ~ 2018.01.24)

## TIL

## 1. DB 없이 회원가입, 사용자 목록조회 기능 구현해보기
### 1-1) 학습 방향과 학습 방법
### 1-2) MVC 간단 설명 및 mustache 초간단 학습
### 1-3) 회원가입 기능 구현

## 2. DB를 사용해 데이터 저장하기 (반복주기 3-1)
### 2-1) 데이터베이스 설정
### 2-2) User 클래스 DB 테이블에 mapping
### 2-3) Controller 에서 repository 사용
### 2-4) 실습
---
### 1-1) 학습 방향과 학습 방법

ㄱ) POBI(박재성 님)의 YOUTUBE 동영상을 보며 직접 따라해보기.

ㄴ) 리눅스 명령어 반복숙달

ㄷ) 서버 시작 및 종료 반복숙달

---
### 1-2) MVC 간단 설명 및 mustache 초간단 학습

1) 새로운 package 생성 및 내부에 class 생성. -> controller로 만들 예정.
- 컴파일러는 이 클래스가 컨트롤러인지 알 수 없다. 따라서 어노테이션을 달아주어야 한다.
> @Controller

- 이후에 command + shift + m 단축키로 import 한다. 이로써 컨트롤러 클래스로써의
역할 부여가 끝난다.

2) 이제 컨트롤러 클래스 안에 메서드를 만들어보자.

```java
package net.slipp.web;

import org.springframework.stereotype.Controller;

@Controller
public class WelcomeController {
	public String welcome() {
		return "welcome";
	}
}
```

이후에 static -> templates 안에 html 파일을 만들어준다. 이름은 welcome.html로 한다.

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Welcome</title>
</head>
<body>
Hello, World!
</body>
</html>
```

이렇게 만들어 준 뒤, 컨트롤러에 어떤 방식으로 저 html 파일을 띄워줄지에 대한 어노테이션을
달아준다.

```java
package net.slipp.web;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class WelcomeController {
	@GetMapping("/helloworld")
	public String welcome() {
		return "welcome";
	}
}
```
> @GetMapping 어노테이션을 달면 자동으로 GetMapping 이 import 된다.

컨트롤러에서 "welcome" 는 단순히 그 단어(String)가 아닌, welcome.html 을
리턴해준다는 의미로 변경된다. (뒤의 파일 형식까지 적어줄 필요 없다.)

이후 html 문서를 수정하여 출력되는 화면을 변경해주면 된다.
이 때, Model에 정보들을 담아서 출력해주는 방식은,

```java
package net.slipp.web;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class WelcomeController {
	@GetMapping("/helloworld")
	public String welcome(String name, int age, Model model) {
		System.out.println("name : " + name + ", age : " + age);
		model.addAttribute("name", name);
		model.addAttribute("age", age);
		return "welcome";
	}
}
```

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Welcome</title>
</head>
<body>
{{name}}, Hello, World!</br>
you are {{age}} years old.
</body>
</html>
```

와 같은식으로 구현하면 된다.

---
### 1-3) 회원가입 기능 구현

server로 data를 전달할 때에 html 문서 내에서 <\form> 태그를 사용한다.
<\form> 태그 안에는 action 속성을 부여할 수 있다. action 속성은 server에 요청을
보낼 때, 어떤 url 주소로 보낼건지에 대한 속성이다. 이는 아래와 같이 사용 가능하다.
> <\form action="/testpage">

---
### 2-1) 데이터베이스 설정

의존관계 설정
- pom.xml에 다음 라이브러리에 대한 의존관계를 설정한다.

```html
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <version>1.4.192</version>
</dependency>
```

DB connection 설정
- application.properties 에 DB connection 정보를 설정한다.

```java
spring.datasource.url=jdbc:h2:~/my-web;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
```

---
### 2-2) User 클래스 DB 테이블에 mapping

User 클래스를 DB 테이블에 매핑하는 방법
- User 클래스를 DB 테이블에 매핑하면, DB 테이블은 별도로 생성할 필요없이 자동으로 생성된다.

- 방법

> 1) User 클래스를 @Entity로 설정한다.

> 2) User 클래스에 대한 유일한 key 값을 @Id로 매핑한다.

> 3) @Id에 @GeneratedValue 애노테이션을 추가하면 key가 자동으로 증가한다.

> 4) 각 필드를 테이블 칼럼과 매핑할 때는 @Column 애노테이션을 사용한다.

```java
import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;

@Entity
public class User {
    @Id
    @GeneratedValue
    private Long id;

    @Column(nullable=false, length=20)
    private String userId;

    private String password;
    private String name;
    private String email;

    [...각 필드에 대한 setter, getter method...]
}
```

---
### 2-3) Controller 에서 repository 사용

- 1) 사용자 데이터를 추가, 조회하기 위해 더 이상 ArrayList를 사용하지 말자.
`@Autowired 애노테이션` 을 활용해 UserRepository를 추가한다.

```java
@Controller
@RequestMapping("/users")
public class UserController {

  @Autowired
  private UserRepository userRepository;

  @PostMapping("")
  public String create(User user) {
    System.out.println("user : " + user);
    userRepository.save(user);
    return "redirect:/users";
  }
}
```

- 2) DB에 DATA 를 추가하는 방법

> UserRepository의 save() 메소드를 통해 DB에 사용자 데이터를 추가한다.

```java
//변경 전
List users = new ArrayList<User> ();

@PostMapping("/users")
public String create(User user, Model model) {
		System.out.println("user : " + user);
		users.add(user);
		model.add("users", users);
		return "redirect:/user/list";
}
```
```java
//변경 후
@PostMapping("/users")
public String create(User user) {
		System.out.println("user : " + user);
		userRepository.save(user);
		return "redirect:/user/list";
}
```

- 3) 목록 조회방법

> UserRepository의 findAll() 메소드를 통해 DB에 저장되어 있는 목록을 조회한다.

```java
//변경 전
List users = new ArrayList<User> ();

@GetMapping("/users/{userId}")
public String seeUser(@PathVariable String userId, Model model) {
		for (User user : users) {
				if (userId.equals(user.getUserId())) {
					model.addAttribute("user", user);
				}
		}
		return "profile";
}
```
```java
//변경 후
@Autowired
private UserRepository userRepository;

@GetMapping("/users/{userId}")
public String seeUser(@PathVariable String userId, Model model) {
		for (User user : userRepository.findAll()) {
				if (userId.equals(user.getUserId())) {
					model.addAttribute("user", user);
				}
		}
		return "profile";
}
```

- 4) 1개의 일치하는 데이터 찾기

> 사용자 목록을 출력하는 곳에서 {{@index}}를 사용하는 대신 {{id}}를 사용한다.

> UserRepository의 findOne() 메소드를 통해 DB에 저장되어 있는 사용자 데이터 조회한다.

```java
//변경 전
List users = new ArrayList<User> ();

@GetMapping("/{index}/form")
public String seeUser(@PathVariable String userId, Model model) {
		for (User user : users) {
				if (userId.equals(user.getUserId())) {
					model.addAttribute("user", user);
				}
		}
		return "profile";
}
```
```java
//변경 후
@GetMapping("/{id}/form")
public String updateForm(@PathVariable long id, Model model) {
		User user = userRepository.findOne(id);
		model.addAttribute("user", user);
		return "updateForm";
}
```

---
### 2-4) 실습
